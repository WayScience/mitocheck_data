# 0. Download MitoCheck Mitosis Movies

In this module, we download all timelapse confocal microscopy mitosis movies generated by [MitoCheck](https://www.mitocheck.org/). 
All of the movies are publicly available and hosted by Open Microscopy.

The files are located at https://idr.openmicroscopy.org/cell/ under accession `idr0013(screenA)`.
The  MitoCheck paper referencing the data is available at https://doi.org/10.1038/nature08869.

## Step 1: Install Aspera

Install Aspera high-speed transfer client as described at https://github.com/IBM/aspera-cli#installation.
We used the direct installation method.

### Step 1a: Allow Aspera to run without password

It is necessary to allow Aspera command line interface (ascp) to run without a password to use it more easily with python.
In order to run ascp without a password do the following:
1) Type sudo visudo at the terminal to open the sudo permissions (sudoers) file
2) Find the line with: `%sudo   ALL=(ALL:ALL) ALL`
3) **Below that line**, insert the following line: `username  ALL=(ALL) NOPASSWD: path_to_aspera`

  Note: `username` is your username and path_to_aspera can be found with `ascli config ascp show`
  
4) Save and exit the editor

## Step 2: Download Aspera Public Key

Download and configure [Aspera public key](https://idr.openmicroscopy.org/about/img/aspera/asperaweb_id_dsa.openssh) and save to `0.download_data` folder.

## Step 3: Setup Download Environment

### Step 3a: Create Download Environment

```sh
# Run this command to create the conda environment for downloading data
conda env create -f 0.download_env.yml
```

### Step 3b: Activate Download Environment

```sh
# Run this command to activate the conda environment for downloading data
conda activate download_data_mitocheck
```

## Step 4: Download Labeled Data with Aspera

Use [Aspera training downloader](aspera_training_downloader.ipynb) to download the raw data that has been manually annotated by Mitocheck as described in the [original paper](https://www.nature.com/articles/nature08869#Sec2).
The downloader works in 2 steps:
1) This downloader first determines which wells from which plates have labels (from training data sent by J-K Heriche) and saves these plates/wells to `training_locations.tsv`.
2) Next, the downloader uses these locations to run an Aspera download command and save the [CellH5](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3673213/) file corresponding to each training location.

### Step 4a: Execute Training Data Download

```bash
# Run this script to download training movies
bash 0.download_training_movies.sh
```